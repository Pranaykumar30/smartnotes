<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}SmartNotes{% endblock %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
      .navbar a.profile-chip:hover {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 6px 12px;
      }
      .dropdown-toggle:hover {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 6px 12px;
      }

      
      body.dark-mode {
        background-color: #121212;
        color: #e0e0e0;
      }

      .dark-mode .navbar {
        background-color: #1f1f1f;
      }

      .dark-mode .card {
        background-color: #1e1e1e;
        color: #e0e0e0;
      }

      .dark-mode .form-control,
      .dark-mode .form-select {
        background-color: #2a2a2a;
        color: #e0e0e0;
        border-color: #444;
      }

      .dark-mode .form-control:focus {
        border-color: #888;
        box-shadow: none;
      }

      .dark-mode .dropdown-menu {
        background-color: #2e2e2e;
        color: #fff;
      }

      .dark-mode .dropdown-item {
        color: #e0e0e0;
      }

      .dark-mode .dropdown-item:hover {
        background-color: #3a3a3a;
      }
      .dark-mode .form-control,
      .dark-mode .form-select {
        border: 1px solid #444;
      }
      .dark-mode ::placeholder {
        color: #bbb !important;
      }
      .dark-mode .text-muted {
        color: #aaa !important;
      }
      .dark-mode .form-control,
      .dark-mode .form-select {
        background-color: #1e1e1e;
        color: #e0e0e0;
        border-color: #555;
      }

      .dark-mode .form-control:focus {
        background-color: #262626;
        color: #fff;
        border-color: #888;
        box-shadow: none;
      }

      .dark-mode .card {
        background-color: #1c1c1c;
        color: #f0f0f0;
      }

      .dark-mode ::-webkit-scrollbar {
        width: 8px;
      }
      .dark-mode ::-webkit-scrollbar-thumb {
        background-color: #444;
        border-radius: 4px;
      }

       /* Default light mode */
      .summary-card {
        background-color: #ffffff;
        color: #333;
      }

      .summary-card .list-group-item {
        background-color: transparent;
        border: none;
        padding: 0.6rem 0.75rem;
      }

      /* Dark mode override */
      body.dark-mode .summary-card {
        background-color: #1e1e1e;
        color: #e0e0e0;
      }

      body.dark-mode .summary-card .list-group-item {
        background-color: transparent;
        color: #d3d3d3;
        border-bottom: 1px solid #444;
      }

      body.dark-mode .summary-card .list-group-item:last-child {
        border-bottom: none;
      }


    </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-dark px-3">
    <a href="{% url 'dashboard' %}" class="navbar-brand text-white">SmartNotes</a>

    <div class="ms-auto d-flex align-items-center gap-2">
      <button id="darkModeToggle" class="btn btn-sm btn-outline-light me-3">üåô</button>
      {% if request.user.is_authenticated %}
        <div class="dropdown">
          <a class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <img
              src="{% if request.user.profile.image %}
                    {{ request.user.profile.image.url }}
                  {% else %}
                    https://res.cloudinary.com/dgvhgcmhc/image/upload/samples/cloudinary-icon
                  {% endif %}"

              class="rounded-circle"
              width="32"
              height="32"
              style="object-fit: cover;"
            >

            <span>{{ request.user.username }}</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
            <li><a class="dropdown-item" href="{% url 'public_profile' request.user.username %}">üë§ View Profile</a></li>
            <li><a class="dropdown-item" href="{% url 'add_note' %}">üóíÔ∏è Add New Note</a></li>
            <li><a class="dropdown-item" href="{% url 'category_list' %}">üìÇ Manage Categories</a></li>
            <li>
              {% if today_notes_exist %}
                <a class="dropdown-item"  href="{% url 'todays_notes' %}">
                  üóì View Today‚Äôs Notes
                </a>
              {% endif %}
            </li>
            <li><a class="dropdown-item" href="{% url 'profile_edit' %}">‚öôÔ∏è Settings</a></li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <form method="post" action="{% url 'logout' %}">
                {% csrf_token %}
                <button type="submit" class="dropdown-item text-danger">üö™ Logout</button>
              </form>
            </li>
            <li><a class="dropdown-item" href="{% url 'password_reset' %}">üîë Reset Password</a></li>
          </ul>
        </div>
        

        {% if not request.user.is_authenticated %}
          <a href="{% url 'register' %}" class="btn btn-sm btn-outline-light">Sign Up</a>
        {% endif %}


      {% endif %}
    </div>
  </nav>

  {% block content %}{% endblock %}

  <script>
    const searchInput = document.getElementById("searchInput");
    const categorySelect = document.getElementById("categorySelect");
    const noteContainer = document.getElementById("noteContainer");

    function performSearch() {
      const query = searchInput.value;
      const categoryId = categorySelect.value;

      fetch(`/search/?q=${encodeURIComponent(query)}&category_id=${encodeURIComponent(categoryId)}`)
        .then(response => response.json())
        .then(data => {
          noteContainer.innerHTML = data.html;
        });
    }

    searchInput.addEventListener("input", performSearch);
    categorySelect.addEventListener("change", performSearch);

  </script>

  <script>
    const toggleBtn = document.getElementById('darkModeToggle');
    const body = document.body;

    function setMode(isDark) {
      if (isDark) {
        body.classList.add('dark-mode');
        localStorage.setItem('darkMode', 'true');
        if (toggleBtn) toggleBtn.textContent = '‚òÄÔ∏è';
      } else {
        body.classList.remove('dark-mode');
        localStorage.setItem('darkMode', 'false');
        if (toggleBtn) toggleBtn.textContent = 'üåô';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('darkMode') === 'true';
      setMode(saved);

      if (toggleBtn) {
        toggleBtn.addEventListener('click', () => {
          const isDark = body.classList.contains('dark-mode');
          setMode(!isDark);
        });
      }
    });
  </script>

  <script>
    function animateCount(id, endValue, speed = 25) {
      const el = document.getElementById(id);
      let start = 0;

      const step = () => {
        if (start < endValue) {
          start++;
          el.textContent = start;
          setTimeout(step, speed);
        } else {
          el.textContent = endValue;
        }
      };

      step();
    }

    document.addEventListener("DOMContentLoaded", () => {
      animateCount("overdueCount", {{ overdue_count }});
      animateCount("todayCount", {{ today_count }});
      animateCount("upcomingCount", {{ upcoming_count }});
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
